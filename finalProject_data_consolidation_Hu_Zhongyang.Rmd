---
title: "WildFire_Project"
author: "Sumanth Nallamotu"
date: "3/19/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

Data Loading
```{r}
library("RSQLite")
connection <- dbConnect(drv=RSQLite::SQLite(), dbname="wildfires_historic.sqlite")
tables <- dbListTables(connection)
tables <- tables[tables != "sqlite_sequence"]
cali_fires = dbGetQuery(conn=connection, statement=paste("SELECT * FROM 'Fires' WHERE STATE = 'CA'"))
rainfall <- read.csv("rainfall_daily.csv")
soilmoisture <- read.csv("soilmoisture_daily.csv")
airtemp <- read.csv("airtemp_daily.csv")
fire_budget <- read.csv("fire_suppression.csv")
dbDisconnect(connection)
```

Data Cleaning

First, we will remove the unnecessary columns from the wildfire dataset
```{r}
cleaned_fires <- subset(cali_fires, select = -c(OBJECTID, FOD_ID, FPA_ID, SOURCE_SYSTEM_TYPE, SOURCE_SYSTEM, NWCG_REPORTING_AGENCY, NWCG_REPORTING_UNIT_ID, NWCG_REPORTING_UNIT_NAME, SOURCE_REPORTING_UNIT, SOURCE_REPORTING_UNIT_NAME, LOCAL_FIRE_REPORT_ID, LOCAL_INCIDENT_ID, FIRE_CODE, ICS_209_INCIDENT_NUMBER, ICS_209_NAME, MTBS_ID, MTBS_FIRE_NAME, COMPLEX_NAME, OWNER_CODE, OWNER_DESCR, Shape, COUNTY, FIPS_CODE, FIPS_NAME, FIRE_NAME,  LATITUDE, LONGITUDE,DISCOVERY_TIME,CONT_TIME))
```

Next, will adjust the Air Temperature dataset so that it includes the yearly average temperatures
```{r}
airtemp$month <- strftime(airtemp$time, "%m")
airtemp$year <- strftime(airtemp$time, "%Y")
airtemp$DOY <- strftime(airtemp$time, "%j")
library(dplyr)
str(airtemp)
cleaned_airtemp <- subset(airtemp, select = -c(time))
'
str(cleaned_airtemp)
cleaned_airtemp <- aggregate(tair_day_livneh_vic~ year, cleaned_airtemp, mean)
str(cleaned_airtemp)
'


summary(cleaned_fires)

str(cleaned_airtemp)
```

Next, we do the same to the Rainfall dataset so that it includes the yearly average rainfall
```{r}

rainfall$year <- strftime(rainfall$time, "%Y")
rainfall$DOY <- strftime(airtemp$time, "%j")

cleaned_rainfall <- subset(rainfall, select = -c(time))
'
cleaned_rainfall <- aggregate(rainfall_day_livneh_vic ~ year, cleaned_rainfall, mean)
colnames(cleaned_rainfall) <- c("Yearmonth", "Avg_Rainfall")
'
str(cleaned_rainfall)

```

And then we do the same to the Soil Moisture dataset so that it includes the yearly average soil moisture
```{r}
soilmoisture$year <- strftime(rainfall$time, "%Y")
soilmoisture$DOY <- strftime(airtemp$time, "%j")

cleaned_soilmoisture <- subset(soilmoisture, select = -c(time))
'
cleaned_soilmoisture <- aggregate(soilmoist1_day_livneh_vic ~ year, cleaned_soilmoisture, mean)
colnames(cleaned_soilmoisture) <- c("Yearmonth", "Avg_SoilMoisture")
'
str(cleaned_soilmoisture)
```

Finally, we combine our data into one comprehensive dataset.
```{r}
joined1 <- merge(cleaned_airtemp, cleaned_soilmoisture, by.x=c("year",'DOY'), by.y=c("year",'DOY'))
joined2 <- merge(joined1, cleaned_rainfall, by.x=c("year",'DOY'), by.y=c("year",'DOY'))
str(joined2)
joined2$year=as.integer(joined2$year)
joined2$DOY=as.integer(joined2$DOY)


final_wildfire <- merge(fire_budget, cleaned_fires, by.x="Year", by.y="FIRE_YEAR")
final_wildfire$existDay = final_wildfire$CONT_DATE- final_wildfire$DISCOVERY_DATE

final_wildfire=merge(final_wildfire,joined2,by.x=c('Year','DISCOVERY_DOY'),by.y=c('year','DOY'),all.x=TRUE)
str(final_wildfire)
summary(final_wildfire)
```

```{r}
nrow(final_wildfire)
ncol(final_wildfire)
final_wildfire$STAT_CAUSE_CODE=as.factor(final_wildfire$STAT_CAUSE_CODE)

str(final_wildfire)

table(final_wildfire$month)

table(final_wildfire$Year)
table(final_wildfire$STAT_CAUSE_DESCR)

fire_nature=final_wildfire[final_wildfire$STAT_CAUSE_DESCR %in% c('Lightning','Miscellaneous','Missing/Undefined'),]
table(fire_nature$month)
fire_peoplecause=final_wildfire[final_wildfire$STAT_CAUSE_DESCR %in% c('Arson','Campfire','Children','Debris Buring','Equipment use','Firework','Powerline','Railroad','Smoking','Structure'),]
table(fire_peoplecause$month)
```
create summary by month



```{r}
temp=aggregate(tair_day_livneh_vic~Year+month,data=final_wildfire,mean)
temp1=aggregate(soilmoist1_day_livneh_vic~Year+month,data=final_wildfire,mean)

temp2=aggregate(rainfall_day_livneh_vic~Year+month,data=final_wildfire,mean)
joined3=merge(temp,temp1,by.x=c('Year','month'),by.y=c('Year','month'))
joined3=merge(joined3,temp2,by.x=c('Year','month'),by.y=c('Year','month'))
temp3=fire_peoplecause %>% count(Year, month)
joined3=merge(joined3,temp3,by.x=c('Year','month'),by.y=c('Year','month'))
temp3=aggregate(FIRE_SIZE~Year+month,data=fire_peoplecause,mean)
summary_peoplecaused=merge(joined3,temp3,by.x=c('Year','month'),by.y=c('Year','month'))

temp=aggregate(tair_day_livneh_vic~Year+month,data=final_wildfire,mean)
temp1=aggregate(soilmoist1_day_livneh_vic~Year+month,data=final_wildfire,mean)

temp2=aggregate(rainfall_day_livneh_vic~Year+month,data=final_wildfire,mean)
joined3=merge(temp,temp1,by.x=c('Year','month'),by.y=c('Year','month'))
joined3=merge(joined3,temp2,by.x=c('Year','month'),by.y=c('Year','month'))
temp3=fire_nature %>% count(Year, month)
joined3=merge(joined3,temp3,by.x=c('Year','month'),by.y=c('Year','month'))
temp3=aggregate(FIRE_SIZE~Year+month,data=fire_nature,mean)

summary_nature=merge(joined3,temp3,by.x=c('Year','month'),by.y=c('Year','month'))
summary_nature=merge(summary_nature,fire_budget,by.x='Year',by.y='Year')
summary_peoplecaused=merge(summary_peoplecaused,fire_budget,by.x='Year',by.y='Year')

write.csv(summary_nature,'summary_nature.csv')
write.csv(summary_peoplecaused,'summary_peoplecaused.csv')
write.csv(final_wildfire,'final_wildfire.csv')
```