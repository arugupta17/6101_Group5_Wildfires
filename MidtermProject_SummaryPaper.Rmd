---
title: "WildFire_Project Summary Paper"
author: "Arundhati G., Zhongyang H., Adarsh K., Sumanth N."
# date: "today"
date: "`r Sys.Date()`"
output:
  html_document:
    code_folding: hide
    number_sections: false
    toc: yes
    toc_depth: 3
    toc_float: yes
  pdf_document:
    toc: yes
    toc_depth: '3'
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE,warning = FALSE)
library('ezids')
library(stringr)
```
# Chapter 1: Introduction of Project
 
  California continues to experience longer wildfire seasons due to climate change. In the past couple of years, as the world navigated through the COVID-19 outbreak, Californians also had to deal with large wildfires. With rising concerns over climate change and its impact on our lives, our research aimed to study the causes and effects of wildfires and increase awareness of the issue. With an abundance of environmental data out there, we hoped to use some of it to come up with recommendations in terms of budget allocation and identify particular pain points. 

	 The summary is organized in following chapters:
	      1. Chapter 2: Description of Dataset
	      2. Chapter 3: EDA of observations of wildfires
	      3. Chapter 4: EDA of annually and monthly statistics
	      4. Chapter 5: correlation and linear model, SMART questions
	      5. Chapter 6: conclusion 
	      
  

```{r }
WildfireData <- read.csv('final_wildfire.csv')
summary_nature=read.csv('summary_nature.csv')
summary_peoplecaused=read.csv('summary_peoplecaused.csv')
fire_budget  <- read.csv("fire_suppression.csv")
```

```{r}

Avg_Temp <- WildfireData$tair_day_livneh_vic
Avg_SoilMoisture <- WildfireData$soilmoist1_day_livneh_vic
Avg_Rainfall <- WildfireData$rainfall_day_livneh_vic

```

# Chapter 2: Discription of Dataset
  The first dataset we found was composed of 1.88 million wildfires around the United States as recorded by the Fire Program Analysis (FPA) system. We not only needed to find a dataset that met the dataset size requirement, but also wanted to look into a problem with many records so that we could conduct wide-reaching analysis. Thus, we settled on analyzing wildfires all across California from 1992 to 2013. However, this dataset alone would not help us get into the level of detail that we hoped for. For example, most of the columns in this dataset detailed the same characteristics such as months, years, days, unit numbers, and unit IDâ€™s. For our analysis, we required more data about the conditions during these fires for the purpose of potentially mitigating future wildfires in the same conditions. 
For that reason, we drew from other datasets in hopes of a more comprehensive analysis. Luckily, an organization called Cal-Adapt collects different peer-reviewed datasets about California from various data publishers and provides them for download in one location. When looking at the available data, three features stood out: soil moisture, air temperature, and rainfall. Naturally, we felt that these metrics were important factors in determining whether or not a wildfire will occur and how large it will be. All three of these datasets came in daily form, so we had to aggregate them by month and year if we wanted to properly incorporate them into our main dataset with all the wildfires. 
	  We also hypothesized that the California state budget for fire suppression would be an  interesting factor to observe over the years. Did increased/decreased spending have an impact on the frequency/intensity of wildfires over the years? We looked to answer this question in hopes of understanding how state government efforts were helping (or not) the wildfire situation in California. To incorporate this dataset into our main dataset, we merely merged them by year. 
	  As a result, we had one comprehensive dataset with all of the features we initially wanted to look at (rainfall, air temperature, soil moisture, and California state budget) and how relevant they are to the sizes/frequencies of wildfires from 1992-2013. While there are surely many more potential causes of wildfires out there, we felt that these four factors would be a good start for some initial analysis.
	  
## Summary for dataset
```{r, results="markup"}
temp=str_remove(fire_budget$Budget,"[$]")
temp=str_remove_all(temp,"[,]")
fire_budget$Budget=as.numeric(temp)

temp=str_remove(WildfireData$Budget,"[$]")
temp=str_remove_all(temp,"[,]")
WildfireData$Budget=as.numeric(temp)

str(WildfireData)

```

# Chapter 3: EDA and hypothesis testing for Wildfire Observations
HISTOGRAMS

```{r, results="markup"}

library(ggplot2)
library(gridExtra)
#Average Temperature
TempHist <- ggplot(WildfireData, aes(Avg_Temp))+ 
  geom_histogram(binwidth = 0.5, bins = 100, col="black", fill="light blue 2") +
  labs(x="Avg. Temp (C)", y="Frequency", title="HISTOGRAM: Average Temprature") 


#Average Soil Moisture
SoilHist <- ggplot(WildfireData, aes(Avg_SoilMoisture))+ 
  geom_histogram(binwidth = 0.5, bins = 100, col="black", fill="orange red 2") +
  labs(x="Avg. Soil Moisture", y="Frequency", title="HISTOGRAM: Average Soil Moisture") 

#Average Rainfall
RainHist <- ggplot(WildfireData, aes(Avg_Rainfall))+ 
  geom_histogram(binwidth = 0.5, bins = 100, col="black", fill="green 3") +
  labs(x="Avg. Rainfall", y="Frequency", title="HISTOGRAM: Average Rainfall") 

#Wildfire Count by Year
CountHist <- ggplot(WildfireData, aes(Year))+ 
  geom_histogram(binwidth = 0.10, bins = 100, col="black", fill="yellow", stat="count") +
  labs(x="Years", y="Frequency of Wildfires", title="Wildfires count by year", )

Histograms <- grid.arrange(TempHist, SoilHist, RainHist, CountHist, ncol=2, nrow=2)

ggsave("Histograms.jpg", plot = Histograms)
```


Bar Graphs
```{r, results="markup"}

#Fire Size
FireBar <- ggplot(data = WildfireData, aes(x = FIRE_SIZE_CLASS)) +
  geom_bar(col="black", fill="orange")+
  labs(x="Fire Size Class", y="Frequency", title="Frequency of Wildfires by Size Classes") 


#Years
YearsBar <- ggplot(data = WildfireData, aes(x = Year)) +
  geom_bar(col="black", fill="yellow")+
  labs(x="Years", y="Frequency", title="Frequency of Wildfires by Year")

#Budget
BudgetBar <- ggplot(data = WildfireData, aes(x = Budget)) +
  geom_bar(col="black", fill="Pink 2")+
  labs(x="Budget", y="Frequency", title="Frequency of Wildfires by Budget")


grid.arrange(FireBar, YearsBar, nrow=2)


```

Pie Charts
```{r, results="markup"}
lbls <- c("A", "B", "C", "D", "E", "F", "G", "E")
jpeg("sizeclasspie.jpeg")
pie((table(WildfireData$FIRE_SIZE_CLASS)), col=rainbow(length(lbls)), main="Pie Chart of Fire Size Class")

```

```{r, results="markup"}

jpeg("cause_descrpPie.jpeg")

lbls <- c("Lightning", "Eqipment Use", "Smoking", "Campfire", "Debris Burning", "Railroad", "Arson", "Children", "Misc." )
pie((table(WildfireData$STAT_CAUSE_DESCR)), col=rainbow(length(lbls)), main="Pie Chart of Wildfire Cause")

```

```{r}
library(dplyr)
library(ggplot2)
yearly_count <- WildfireData %>% count(Year)
colnames(yearly_count) <- c("Year", "Count")
ggplot(yearly_count, aes(x=Year, y=Count, group=1)) + geom_line() + ggtitle("Yearly Recorded Fires")
```
```{r}
temp=str_remove(fire_budget$Budget,"[$]")
temp=str_remove_all(temp,"[,]")
fire_budget$Budget=as.numeric(temp)
ggplot(fire_budget, aes(x=Year, y=Budget, group=1)) + geom_line() + ggtitle("California Fire Suppression Budget 1979-2021")
```

```{r}
dat <- aggregate(FIRE_SIZE ~ Year, WildfireData, mean)
ggplot(dat, aes(x=Year, y=FIRE_SIZE, group=1)) + geom_line() + ggtitle("Wildfire Sizes (1992-2013)") + ylab("Fire Size")

```






## Hypothesis testing

Setting up different groups for the first hypothesis test. We are looking to compare different
classes of wildfires and how different conditions may have been.
```{r}
classA <- WildfireData[WildfireData$FIRE_SIZE_CLASS == 'A',]
classB <- WildfireData[WildfireData$FIRE_SIZE_CLASS == 'B',]
classC <- WildfireData[WildfireData$FIRE_SIZE_CLASS == 'C',]
classD <- WildfireData[WildfireData$FIRE_SIZE_CLASS == 'D',]
classE <- WildfireData[WildfireData$FIRE_SIZE_CLASS == 'E',]
classF <- WildfireData[WildfireData$FIRE_SIZE_CLASS == 'F',]
classG <- WildfireData[WildfireData$FIRE_SIZE_CLASS == 'G',]
```

When comparing the conditions during the smallest wildfires to the largest wildfires,
it  appears that air temperature was lower, soil moisture was higher, and rainfall was
higher during less  intense wildfires.

```{r}
t.test(classA$tair_day_livneh_vic, classG$tair_day_livneh_vic, var.equal = TRUE)
t.test(classA$soilmoist1_day_livneh_vic, classG$soilmoist1_day_livneh_vic, var.equal = TRUE)
t.test(classA$rainfall_day_livneh_vic, classG$rainfall_day_livneh_vic, var.equal = TRUE)
```
```{r}
code1 <- WildfireData[WildfireData$STAT_CAUSE_CODE == 1,]
code2 <- WildfireData[WildfireData$STAT_CAUSE_CODE == 2,]
code7 <- WildfireData[WildfireData$STAT_CAUSE_CODE == 7,]
```
Now,  we will compare different groups of wildfires- categorized by their causes

Code 1: Lightning
Code 2: Equipment Use
Code 7: Arson

When looking  at  the wildfires caused by  Lightning versus those caused by Equipment
Use,  average temperature, soil moisture, and rainfall in CA were significantly  different.
In particular, during Lighting-caused wildfires, air temperature  was higher, soil moisture
was lower, and rainfall was higher.
```{r}
t.test(code1$tair_day_livneh_vic, code2$tair_day_livneh_vic, var.equal=TRUE)
t.test(code1$soilmoist1_day_livneh_vic, code2$soilmoist1_day_livneh_vic, var.equal=TRUE)
t.test(code1$rainfall_day_livneh_vic, code2$rainfall_day_livneh_vic, var.equal=TRUE)
```

When comparing the wildfires caused by Lightning versus those caused by Arson,
it appears that the air temperature, soil moisture, and average rainfall in CA
were significantly different. In  particular, during lightning-caused wildfires,
air temperature was higher, soil moisture was lower, and average rainfall
was higher.
```{r}
t.test(code1$tair_day_livneh_vic, code7$tair_day_livneh_vic, var.equal=TRUE)
t.test(code1$soilmoist1_day_livneh_vic, code7$soilmoist1_day_livneh_vic, var.equal=TRUE)
t.test(code1$rainfall_day_livneh_vic, code7$rainfall_day_livneh_vic, var.equal=TRUE)
```
When looking at conditions during arson-caused wildfires versus equipment use-caused
wildfires, it appears that air  temperature and soil moisture were significantly  different.
In  particular, during arson-caused fires, air temperature was lower and soil moisture was
higher.
```{r}
t.test(code7$tair_day_livneh_vic, code2$tair_day_livneh_vic, var.equal=TRUE)
t.test(code7$soilmoist1_day_livneh_vic, code2$soilmoist1_day_livneh_vic, var.equal=TRUE)
t.test(code7$rainfall_day_livneh_vic, code2$rainfall_day_livneh_vic, var.equal=TRUE)

```

# Chapter 4: EDA for monthly and annually statistics of wildfire: scatterplot, box-plot and ANOVA

```{r }
final_fire=read.csv('final_wildfire.csv')
summary_nature=read.csv('summary_nature.csv')
summary_peoplecaused=read.csv('summary_peoplecaused.csv')
colnames(summary_nature)[4]='temperature'
colnames(summary_nature)[5]='soilmoisture'
colnames(summary_nature)[6]='rainfall'
colnames(summary_nature)[7]='nfire'
colnames(summary_peoplecaused)[4]='temperature'
colnames(summary_peoplecaused)[5]='soilmoisture'
colnames(summary_peoplecaused)[6]='rainfall'
colnames(summary_peoplecaused)[7]='nfire'
summary_peoplecaused$Year=as.factor(summary_peoplecaused$Year)

summary_peoplecaused$month=as.factor(summary_peoplecaused$month)
summary_nature$Year=as.factor(summary_nature$Year)

summary_nature$month=as.factor(summary_nature$month)
```

## 4.1 Plot of Annually and Monthly Summary

plot the year trend

```{r , results='markup'}
library(ggplot2)

temp_plot=aggregate(nfire~Year,summary_nature,sum)

temp_plot2=aggregate(nfire~Year,summary_peoplecaused,sum)

ggplot() +geom_point(data=temp_plot, aes(x=Year, y=nfire), colour='blue') + geom_point(data=temp_plot2, aes(x=Year, y=nfire),colour='red')+labs(title='Number of Fires Each Year (Red for people-caused, Blue for other reasons)',y='Number of Fires')



```
plot the boxplot of the year and month to show trend

```{r, results='markup' }
library(ggpubr)
ggplot(summary_peoplecaused, mapping=aes(x=Year,y=nfire)) + geom_boxplot()+ggtitle('box-plot of number of people-caused fires for different years')+ylab('Number of Fires')

ggplot(summary_peoplecaused, mapping=aes(x=month,y=nfire)) + geom_boxplot()+ggtitle('box-plot of number of people-caused fires for different months')+ylab('Number of Fires')
ggplot(summary_nature, mapping=aes(x=Year,y=nfire)) + geom_boxplot()+ggtitle('box-plot of number of fires caused by other reasons for different years')+ylab('Number of Fires')

ggplot(summary_nature, mapping=aes(x=month,y=nfire)) + geom_boxplot()+ggtitle('box-plot of number of fires caused by other reasons for different months')+ylab('Number of Fires')

```
```{r}
ggplot(summary_peoplecaused, mapping=aes(x=Year,y=temperature)) + geom_boxplot()+ggtitle('box-plot of temperature for different years')+ylab('temperature')

ggplot(summary_peoplecaused, mapping=aes(x=month,y=temperature)) + geom_boxplot()+ggtitle('box-plot of temperature for different months')+ylab('temperature')
ggplot(summary_nature, mapping=aes(x=Year,y=soilmoisture)) + geom_boxplot()+ggtitle('box-plot of soil moisture for different years')+ylab('soil moisture')

ggplot(summary_nature, mapping=aes(x=month,y=soilmoisture)) + geom_boxplot()+ggtitle('box-plot of soil moisture for different months')+ylab('soil moisture')
ggplot(summary_nature, mapping=aes(x=Year,y=rainfall)) + geom_boxplot()+ggtitle('box-plot of rainfall for different years')+ylab('average daily rainfall')

ggplot(summary_nature, mapping=aes(x=month,y=rainfall)) + geom_boxplot()+ggtitle('box-plot of rainfall for different months')+ylab('average daily rainfall')

```

The result of box-plot suppose the annually summary for all variables(fires number, temperature rainfall and moisture) are consistent and monthly summary for all variables are different. It supposes that we could need to 
take anova test for the mean with those categories.


Do Anova test on the year and month statistics
```{r, results='markup'}
summary(aov(nfire~Year,summary_peoplecaused))
summary(aov(nfire~month,summary_peoplecaused))
summary(aov(nfire~Year,summary_nature))
summary(aov(nfire~month,summary_nature))
summary(aov(temperature~Year,summary_peoplecaused))
summary(aov(temperature~month,summary_peoplecaused))
summary(aov(soilmoisture~Year,summary_nature))
summary(aov(soilmoisture~month,summary_nature))
summary(aov(rainfall~Year,summary_nature))
summary(aov(rainfall~month,summary_nature))
```



We have the null hypothesis that the mean of particular varible with different categories is same
and the alternative hypothesis suppose that mean of particular varible with different categories is different
The anova test give the results
For all of variables with annually categories, we failed to reject the null hypothesis
For all of variables with monthly categories, we reject the null hypothesis.

The result suppose the variables(fires number, temperature, rainfall and moisture) are consistent with year and
have great difference with months

     With the aforementioned datasets, we found that, while they were somewhat useful for our analysis, they werenâ€™t as granular as we hoped they would be. For example, the dataset containing Californiaâ€™s yearly budget for fire suppression could have also included how the money was partitioned across different causes/uses. That way, we would be able to provide more detailed recommendations on where some funds should be redistributed. As it stands, knowing how much money is being dedicated to combating wildfires in itself is not incredibly useful.
	   We also noticed that our main dataset that contained records for every wildfire noted the cause for each of them. Some of them included arson, equipment use, lighting, and many others. However, we noticed in our analysis that miscellaneous causes accounted for the majority of the wildfires. Even a little more detail could have helped us with recommending mitigations. 
In addition, the data dictionaries for our datasets regarding air temperature and soil moisture didnâ€™t really detail what units the data was recorded in. Since we were dealing with data from California  in the United States, we could only assume that Fahrenheit was used but even then, the measurements seemed a bit lower than expected. As for soil moisture, we had to look into what the common unit for this metric was, which turned out to be in bars. 
     Additional  information that would  have been useful is data about human patterns and activities and how they have potentially impacted the frequency/intensity of wildfires over the years. Studying the population growth and housing density in California over time in comparison to incidents of wildfires can provide increased understanding of the causes of human-caused wildfires
We have observed the decreasing trend of people-caused fires from 1995-2013, we need some more data about the government actions on preventing the wildfire caused by human..

# Chapter5: Correlation and Liner Regression model

## 5.1 Correlation Matrix

```{r}
temp=str_remove(summary_nature$Budget,"[$]")
temp=str_remove_all(temp,"[,]")
summary_nature$Budget=as.numeric(temp)
temp=str_remove(summary_peoplecaused$Budget,"[$]")
temp=str_remove_all(temp,"[,]")
summary_peoplecaused$Budget=as.numeric(temp)
cor_nature=cor(summary_nature[c(4:9)])

library(corrplot)

cor_people=cor(summary_peoplecaused[c(4:9)])



colnames(summary_nature)[7]='nature_fire'
summary_nature$people_caused_fires=summary_peoplecaused$n
summary_nature$total=summary_nature$nature_fire+summary_peoplecaused$n
cor_total=cor(summary_nature[c(4,5,6,9,7,10,11)])


corrplot(cor_total,method='number',type = 'lower', diag = TRUE)
```

    From the EDA, we try to evaluate the wildfries in two cases: people-caused and other reason(usually natrual reason). The result suppose that fires number for both type(man-caused and other) has strong correlation with temperature and moisture. This implies that we could make model to evaluate the influence of nature factors to answer SMART question.



## Model
create model for fires and high correlated variable
and check their summary, use vif to determine the variable useage

use residual plot and qq-plot to check their normality
```{r}

model1=lm(total~temperature,data=summary_nature)
summary(model1)

model2=lm(total~temperature+soilmoisture,data=summary_nature)
plot(model2)
summary(model2)
model3=lm(total~temperature+soilmoisture+rainfall,data=summary_nature)
summary(model3)

library(car)
vif(model3)
vif(model2)
model4=lm(total~soilmoisture,data=summary_nature)

summary(model4)



model5=lm(log(total)~temperature+soilmoisture,data=summary_nature)
residualPlot(model5)
plot(model5)
summary(model5)
vif(model5)
```

Try the different setting on model: model with temperature; temperature and moisture,temperature 
moisture and rainfall. The vif check find the inflation of factors with 3 variables. Then the best factor set is temperatre and moisture. The model is also ploted with residual, the residual mean is strongly curved. Then Apply with log transformation with the fire number, the results is better. The gg-plot suppose the approximate normal for the residual. The model has the r-square of 0.89 and the F-test for p-value: < 2.2e-16. Both results suppose the model can strongly predict the monthly wildfire case by monthly average temperature and average soil moisture.
